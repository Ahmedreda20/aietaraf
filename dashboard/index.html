<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta name="description" content="قم بارسال اعتراف من قلبك لصديقك او لشخص ما تود ان تعترف له بشيء ما بداخلك بدون معرفة من انت">
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="keywords" content="love crush i love you Aietaraf li aietaraf li aietaraf  heart"> -->
    <link rel="icon" href="../img/couple.png" type="image/png">
    <link rel="stylesheet" href="./style/style.css">
    <title> لوحة التحكم </title>
</head>
<body>
    <header>
<div class="logo">
    <a href="#">
        <img src="../img/couple.png" alt="logo">
        
    </a>
</div>
<div class="reg">
    <input type="checkbox"  id="bar">
    <label class="btn-bar" for="bar">
        <span></span>
        <span></span>
        <span></span>
    </label>

    <div class="settings">
        <ul>
            <li id="newMessage">
                رسالة جديدة
            </li>
            <li>
                اتصل بنا 
                <ul>
                    <li>
                        <a href="mailto:">ahmedreda0219@gmail.com</a>
                    </li>
                    <li>
                        <a href="tel:">+201145099681</a>
                    </li>
                </ul>
            </li>
            <li>
                <button class="btn-signout">
                    تسجيل الخروح
                </button>
            </li>
        </ul>
    </div>


</div>
    </header>


<div class="container">

    <div class="box">
        <div class="profile-pic">
            <input type="file" id="profile" accept="image/*">
            <label for="profile">
                تغيير الصورة الشخصية
            </label>
        </div>
        <div class="user-img">
         
            <div class="img">
                <svg  viewBox="0 0 33.83098862 33.83098862" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16.9" cy="16.9" r="15.9"></circle>
                    <circle cx="16.9" cy="16.9" r="15.9"></circle> 
                    </svg>
                    <img src="./couple.png" alt="" id="user-img">
            </div>



        </div>
            <div class="content">
                <ul>
                    <li >
                        <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="user" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="svg-inline--fa fa-user fa-w-14 fa-7x"><path fill="currentColor" d="M313.6 288c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zM416 464c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16v-41.6C32 365.9 77.9 320 134.4 320c19.6 0 39.1 16 89.6 16 50.4 0 70-16 89.6-16 56.5 0 102.4 45.9 102.4 102.4V464zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm0-224c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z" class=""></path></svg>
                    <span id="fullname"></span>
                    </li>
                    <li>
                        <svg aria-hidden="true" focusable="false" data-prefix="fal" data-icon="at" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="svg-inline--fa fa-at fa-w-16 fa-7x"><path fill="currentColor" d="M256 8C118.941 8 8 118.919 8 256c0 137.058 110.919 248 248 248 52.925 0 104.68-17.078 147.092-48.319 5.501-4.052 6.423-11.924 2.095-17.211l-5.074-6.198c-4.018-4.909-11.193-5.883-16.307-2.129C346.93 457.208 301.974 472 256 472c-119.373 0-216-96.607-216-216 0-119.375 96.607-216 216-216 118.445 0 216 80.024 216 200 0 72.873-52.819 108.241-116.065 108.241-19.734 0-23.695-10.816-19.503-33.868l32.07-164.071c1.449-7.411-4.226-14.302-11.777-14.302h-12.421a12 12 0 0 0-11.781 9.718c-2.294 11.846-2.86 13.464-3.861 25.647-11.729-27.078-38.639-43.023-73.375-43.023-68.044 0-133.176 62.95-133.176 157.027 0 61.587 33.915 98.354 90.723 98.354 39.729 0 70.601-24.278 86.633-46.982-1.211 27.786 17.455 42.213 45.975 42.213C453.089 378.954 504 321.729 504 240 504 103.814 393.863 8 256 8zm-37.92 342.627c-36.681 0-58.58-25.108-58.58-67.166 0-74.69 50.765-121.545 97.217-121.545 38.857 0 58.102 27.79 58.102 65.735 0 58.133-38.369 122.976-96.739 122.976z" class=""></path></svg>
                        <span id="email"></span>
                    </li>
                    <li>
                        <div class="group-form">
                      
                            <label for="user">قم بالنسخ ومشاركته مع الاخرين</label>
                        <button class="btn-copy">
                            Copy
                            </button>
                            <input type="text" disabled placeholder="user id" id="user">
                        </div>
                    </li>
                    <li id="more">
                    </li>
                </ul>
            </div>
    </div>


    <div class="box">
        <h1>
            الرسائل
        </h1>
       <div class="itmes">
           <div class="msg-box">
           </div>
        </div>
        <h1>
            لا يوجد هناك اى رسالة
        </h1>
    </div>
</div>

<div class="create-new-message">
    <div class="popup">
        <div class="box">
            <button class="btn-close">
                <span></span>
                <span></span>
            </button>
        <form class="sendmessage">
            <div class="group-form">
                <label for="userid">ادخل  <span>ID</span> الخاص بالمرسل اليه  </label>
                <input type="text" id="userid" placeholder="lthsngsvoecapebsuthsqebotfsg" min="0" maxlength="28" required>
            </div>
            <div class="group-form">
                <label for="message">اكتب رسالتك</label>
                <textarea  id="message" placeholder="..." required minlength="0" maxlength="200"></textarea>
            </div>
            <div class="group-form">
                <button class="btn-submit">
                    ارسال
                </button>
            </div>
        </form>
        </div>
    </div>
</div>
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-storage.js"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/7.16.0/firebase-analytics.js"></script> -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAj0hHFR8cSUHCpKUg-j200K8nO7CzVIDM",
    authDomain: "aietaraf.firebaseapp.com",
    databaseURL: "https://aietaraf.firebaseio.com",
    projectId: "aietaraf",
    storageBucket: "aietaraf.appspot.com",
    // messagingSenderId: "840654250498",
    appId: "1:840654250498:web:bea3a7f8d462ceaa897d1b",
    measurementId: "G-WHJG5TVG7M"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

 var db = firebase.firestore();
  var ap = document.querySelector('.msg-box')
  var parentBox = document.querySelector('.box h1:last-child')
var username = document.getElementById('fullname')
var useremail = document.getElementById('email')
var userabout = document.getElementById('more')

 firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var img = document.querySelector('#user-img');
    var storage = firebase.storage().ref('users/' + user.uid);
    if(storage){
        firebase.storage().ref('users/' + user.uid + '/profile.png').getDownloadURL().then(imgUrl =>{
            img.src = imgUrl;
        }).catch(function(error){
            console.log(error.message)
        });
    }
    db.collection('users').doc(user.uid).get().then(function(doc) {
        if (doc.exists) {
            username.innerHTML = doc.data().name;
            useremail.innerHTML = doc.data().email;
            userabout.innerHTML = doc.data().about;
                copyText.value = doc.data().username;

    } 
    });
setTimeout(() => {
    db.collection("message").doc(copyText.value).collection('messages').get().then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
                 if (doc.exists) {
         parentBox.remove()
         var msg = document.createElement('DIV');
          var msgContent = document.createElement('DIV');
          var content = document.createElement('P');
          msgContent.appendChild(content)
          msg.appendChild(msgContent)
          ap.appendChild(msg)
          msg.setAttribute('class' ,  'msg')
          msgContent.setAttribute('class' ,  'msg-content')
          content.innerHTML = doc.data().msg
                 }
     });
    });
}, 1000);
}
// }else{
//     location.href = "../login"
// }
})

document.querySelector('.btn-signout').onclick = function(){
    firebase.auth().signOut().then(function() {
        location.href = "../index.html"
});
}


var messageForm = document.querySelector('.sendmessage');
messageForm.addEventListener('submit' ,  function(e){
    e.preventDefault();
    var userId = messageForm['userid'].value;
    var usermessage = messageForm['message'].value;
    db.collection('message').doc(userId).collection('messages').doc().set({
        msg: usermessage,
        msgid: userId
    });
    setTimeout(() => {
        location.reload();
    }, 500);
});

var newMessage = document.getElementById('newMessage').onclick = function(){
document.querySelector('.create-new-message').style.display = 'flex';
};

var copyText = document.getElementById("user");
var btn = document.querySelector('.btn-copy');
btn.addEventListener('click' ,  function(){
  copyText.select();
  copyText.setSelectionRange(0, 99999)
  document.execCommand("copy");
});

var btnClose = document.querySelector('.btn-close')
btnClose.addEventListener('click' ,  function(){
    document.querySelector('.create-new-message').style.display = 'none';

});


var loader = document.getElementById('profile').onchange = function(e){
     var file = e.target.files[0];
     console.log(file)
     firebase.storage().ref('users/' + copyText.value + '/profile.png').put(file).then(function(){
     console.log('image already saved');
     })
        }
document.addEventListener('contextmenu', function(e) {
e.preventDefault();
});
document.onkeydown = function(e) {
if(event.keyCode == 123) {
return false;
}
if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
return false;
}
if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) {
return false;
}
if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
return false;
}
if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
return false;
}
if(e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) {
return false;
}
}
</script>
</body>
</html>